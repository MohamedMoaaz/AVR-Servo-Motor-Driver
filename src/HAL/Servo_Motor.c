/**
 * @file    Servo_Motor.c
 * @author  Mohamed Moaaz
 * @brief   Control servo motor angle via PWM
 * @version 0.1
 * @date    2023-10-31
 *
 * @copyright Copyright (c) 2023
 */

//==============================================================================
// Includes
//==============================================================================

#include "STD_TYPES.h"
#include "Map.h"
#include "MCAL/Timer_interface.h"
#include "HAL/Servo_interface.h"

//==============================================================================
// Extern Variables
//==============================================================================


//==============================================================================
// Private Macros & Defines
//==============================================================================


//==============================================================================
// Private Typedefs
//==============================================================================


//==============================================================================
// Static Variables
//==============================================================================


//==============================================================================
// Global Variables
//==============================================================================


//==============================================================================
// Exported Values
//==============================================================================


//==============================================================================
// Static Functions Prototypes
//==============================================================================


//==============================================================================
// Static Functions
//==============================================================================


//==============================================================================
// Global Functions
//==============================================================================

void Servo_Init(void)
{
    /*Initialize custom pwm*/
    Timer1_Init();
}

E_Status Servo_SetAngle(uint8_t copy_u8Angle)
{
    uint16_t Local_u16OnTime;

    uint8_t Local_u8ErrorState = E_OK;
    if (copy_u8Angle > 180)
    {
        Local_u8ErrorState = E_NOK;
    }
    else
    {
        /*map the angle to pwm signal*/
        Local_u16OnTime = Mapping(2500, 750, 180, 0, copy_u8Angle);
        /*set the servo angle*/
        Timer1_StartCustomFastPWM(Local_u16OnTime, 20000);
    }
    return Local_u8ErrorState;
}